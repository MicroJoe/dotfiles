set nocompatible
source ~/.vim/bundles.vim

" Encoding
set encoding=utf-8
set fileencoding=utf-8

" GUI options
if has("gui_running")
    " GUI TrueType font
    if has("win32") || has("win16")
        set guifont=Liberation_Mono:h10:cANSI
    else
        set guifont=DejaVu\ Sans\ Mono\ 10
    endif
    " Remove useless buttons and menu bar
    set guioptions-=m
    set guioptions-=T
    " Set default window size
    set lines=30 columns=85
endif

" Syntax options
syn on
set background=dark

" Indent options
set showmatch
set expandtab
set tabstop=4
set shiftwidth=4
set softtabstop=4
set smartindent

" Mouse is evil, but sometimes useful
set mouse=a

" Interface
set number
set relativenumber
set cursorline cursorcolumn
set showcmd
set colorcolumn=80
set ruler
set scrolloff=3
set ls=2

" Easier way to navigate between windows
map <C-h> <C-w>h
map <C-j> <C-w>j
map <C-k> <C-w>k
map <C-l> <C-w>l

" Searching
set hlsearch
set incsearch
set ignorecase
set smartcase

" Faster scrolldown
nnoremap <C-e> 3<C-e>
nnoremap <C-y> 3<C-y>

" Changing leader key for a more azerty-friendly one (or not)
let mapleader = '\'
let maplocalheader = '\'

" Leader bindings
" nmap <silent> <Leader>nu :set relativenumber<CR>

" Delete all useless whitespaces at the end of each line on saving
autocmd BufWritePre * :%s/\s+$//e

" Autocmd stuff
if has("autocmd")
    " Remember location in file
    au BufReadPost * if line("'\"") > 0 && line("'\"") <= line("$")
    \| exe "normal g'\"" | endif

    " Custom syntax highlighting for specific extensions
    au BufNewFile,BufRead *.json set ft=javascript
    au BufNewFile,BufRead *.eliom set ft=ocaml

    " Yaml folding configuration
    au BufRead,BufNewFile *.{yml,yaml} set foldmethod=indent

    " Autowrap on text files
    au BufNewFile,BufRead *.txt set tw=79
    au BufNewFile,BufRead *.md  set tw=79
    au BufNewFile,BufRead *.tex set tw=79

    " Autowrap on editing mails
    au BufRead /tmp/mutt-* set tw=79

    " Only indent of 2 spaces in editing OCaml and Haskell files
    au BufNewFile,BufRead *.ml set tabstop=2 shiftwidth=2 softtabstop=2
    au BufNewFile,BufRead *.ml set tabstop=2 shiftwidth=2 softtabstop=2
endif

" Allow backspacing over everything in insert mode
set backspace=indent,eol,start

" Wordwrap
set wrap
set linebreak

" Showing invisible characters with cool unicode chars
exec "set listchars=tab:\uBB\uBB,trail:\uB7,nbsp:\u237D"
set list

" Spellchecking
set spelllang=~/.vim/spell/fr.utf-8.spl
set spellfile=~/.vim/spell/fr.utf-8.add

" Completion
filetype plugin on
set omnifunc=syntaxcomplete#Complete
